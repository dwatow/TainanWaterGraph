var D=Object.defineProperty,K=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var A=(e,t,a)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,L=(e,t)=>{for(var a in t||(t={}))Y.call(t,a)&&A(e,a,t[a]);if(S)for(var a of S(t))E.call(t,a)&&A(e,a,t[a]);return e},W=(e,t)=>K(e,N(t));import{a as U,C as V,o as i,c as _,b as f,r as c,d as u,e as h,S as B,G as P,f as o,w as p,F as x,g as Q,t as y,h as j,i as I,A as q}from"./vendor.eae95d6b.js";const H=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function a(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=a(s);fetch(s.href,r)}};H();const M=U.create({baseURL:"https://my-god-render.onrender.com"});var R={GET(e,t){return M.get(e,{params:t})}};var C=(e,t)=>{const a=e.__vccOpts||e;for(const[n,s]of t)a[n]=s;return a};const z={name:"LineChart",props:{title:{type:String,default:""},items:{type:Array,default:()=>[{data:[12,19,3,5,2,3]}]},xAxisLabel:{type:Array,default:()=>["Red","Blue","Yellow","Green","Purple","Orange"]}},mounted(){this.chart=this.initChart({labels:this.xAxisLabel,datasets:this.datasets})},data(){return{chart:null}},methods:{initChart(e){const t=this.$refs.chart;return new V(t.getContext("2d"),{type:"line",data:e,options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:this.title,fullSize:!0},tooltip:{callbacks:{label:({dataset:a,dataIndex:n})=>`${a.data[n]} (${a.location[n]})`}}}}})},radom(e){return Math.floor(Math.random()*e)}},beforeDestroy(){this.chart.destroy()},computed:{datasets(){return this.items.filter(e=>e.data.length).map(e=>W(L({},e),{borderColor:[`rgb(${this.radom(255)}, ${this.radom(255)}, ${this.radom(255)})`],borderWidth:1}))}}},J={class:"chart",ref:"chart",height:"400"};function X(e,t,a,n,s,r){return i(),_("div",null,[f("canvas",J,null,512)])}var Z=C(z,[["render",X],["__scopeId","data-v-f56cc066"]]);const $={name:"WaterChart",components:{LineChart:Z},props:{title:{type:String,default:""},message:{type:Array,required:!0}},data(){return{status:!1}},mounted(){this.$nextTick(()=>{this.status=!0})},watch:{message(){this.status=!1}},updated(){this.$nextTick(()=>{this.status=!0})},methods:{parseValue(e){return e.includes("<")?parseFloat(e.split("<").join("")):e==="\u7121"?parseFloat(0):e},parseSpec(e){return e==="\u7121"?[parseFloat(0)]:e==="--"?[]:e.includes("<")?[parseFloat(e.split("<").join(""))]:e.includes("-")?e.split("-").map(t=>parseFloat(t)):[e]}},computed:{xAxisLabel(){return this.message.map(e=>e.title)},items(){return this.message.reduce((e,t)=>{if(this.title!==""){e[0]={label:"\u53D6\u6A23\u503C",data:[...e[0].data,this.parseValue(t.data.value[this.title])],location:[...e[0].location,t.data.value.\u5099\u8A3B]};const a=this.parseSpec(t.data.spec[this.title]),n=a.length===2?["+1","+1"]:[!1,!1];a.forEach((s,r)=>{e[r+1]={label:"\u6A19\u6E96\u503C",data:[...e[r+1].data,s],fill:n[r],location:[...e[r+1].location,t.data.value.\u5099\u8A3B]}})}return e},[{data:[],location:[]},{data:[],location:[]},{data:[],location:[]}])}}};function ee(e,t,a,n,s,r){const d=c("LineChart");return s.status?(i(),u(d,{key:0,title:a.title,items:r.items,xAxisLabel:r.xAxisLabel},null,8,["title","items","xAxisLabel"])):h("",!0)}var te=C($,[["render",ee]]);const se={name:"WaterGraph",components:{WaterChart:te,SearchOutlined:B,GithubOutlined:P},created(){this.months=Array(12).fill(1).map((e,t)=>e+t).reduce((e,t)=>(e[`${t}`]=null,e),{})},data(){return{status:"",fetchCount:12,message:[],months:{},SearchKeyword:"\u4EC1\u5FB7",SampleYear:2021}},methods:{onSubmit(){this.message=[],this.fetchCount=12,this.months=Array(12).fill(1).map((e,t)=>e+t).reduce((e,t)=>(e[t]=null,e),{}),this.fetchWaterQuality({SearchKeyword:this.SearchKeyword,SampleYear:this.SampleYear})},parseDate(e){const t=e.split("|").pop().trim(),[a,...n]=t.split("\u5E74"),[s,...r]=n.join().split("\u6708"),[d,...g]=r.join().split("\u65E5");return[a,s,d]},async fetchWaterQualityMonth(e,t,a){this.status="\u67E5\u8A62\u4E2D...",this.fetchCount-=1,this.months[a]=null;try{const n=await R.GET("/water-quality",{SearchKeyword:e,SampleYear:t,SampleMonth:a});this.message=[...this.message,...n.data],this.months[a]=n.data.length}catch(n){console.log(n),this.months[a]=-1}finally{this.fetchCount+=1,this.fetchCount===12&&(this.status="")}},async fetchWaterQuality({SearchKeyword:e,SampleYear:t}){Array(12).fill(1).map((a,n)=>a+n).forEach(async a=>{await this.fetchWaterQualityMonth(e,t,a)})}},computed:{items(){return this.message.sort((e,t)=>new Date(this.parseDate(e.title))-new Date(this.parseDate(t.title)))}}},ae={style:{"text-align":"center"}},re={class:"months"},ne={key:0,style:{"background-color":"rgba(255, 206, 86, 1)"}},ie={key:1,style:{"background-color":"rgba(255, 99, 132, 1)"}},oe={key:2,style:{"background-color":"rgba(75, 192, 192, 1)"}},le=j(" to Github repo ");function ce(e,t,a,n,s,r){const d=c("a-input-number"),g=c("a-form-item"),G=c("a-input"),k=c("SearchOutlined"),v=c("a-button"),O=c("a-space"),F=c("a-form"),m=c("WaterChart"),T=c("GithubOutlined");return i(),_(x,null,[o(F,{onSubmit:r.onSubmit,style:{width:"fit-content",margin:"auto"}},{default:p(()=>[o(O,{align:"end"},{default:p(()=>[o(g,{label:"\u5E74\u4EFD",name:"Year"},{default:p(()=>[o(d,{value:s.SampleYear,"onUpdate:value":t[0]||(t[0]=l=>s.SampleYear=l)},null,8,["value"])]),_:1}),o(g,{label:"\u5730\u5340",name:"Keyword"},{default:p(()=>[o(G,{value:s.SearchKeyword,"onUpdate:value":t[1]||(t[1]=l=>s.SearchKeyword=l)},null,8,["value"])]),_:1}),o(g,null,{default:p(()=>[o(v,{disabled:s.fetchCount!==12,type:"primary","html-type":"submit"},{default:p(()=>[o(k)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["onSubmit"]),f("div",ae,[f("p",re,[(i(!0),_(x,null,Q(s.months,(l,w)=>(i(),_("div",null,[f("div",null,y(w)+" \u6708",1),f("div",null,[l==null?(i(),_("div",ne,y(s.status),1)):l<0?(i(),_("div",ie,y(l),1)):(i(),_("div",oe,y(l),1))]),l!=null?(i(),u(v,{key:0,disabled:l>=0,type:"text",onClick:me=>r.fetchWaterQualityMonth(s.SearchKeyword,s.SampleYear,w)},{default:p(()=>[o(k)]),_:2},1032,["disabled","onClick"])):h("",!0)]))),256))])]),s.message.length?(i(),u(m,{key:0,title:"\u6FC1\u5EA6(NTU)",message:r.items.slice()},null,8,["message"])):h("",!0),s.message.length?(i(),u(m,{key:1,title:"\u8272\u5EA6(\u9251\u9237\u55AE\u4F4D)",message:r.items.slice()},null,8,["message"])):h("",!0),s.message.length?(i(),u(m,{key:2,title:"\u81ED\u5EA6(\u521D\u55C5\u6578)",message:r.items.slice()},null,8,["message"])):h("",!0),s.message.length?(i(),u(m,{key:3,title:"pH\u503C",message:r.items.slice()},null,8,["message"])):h("",!0),s.message.length?(i(),u(m,{key:4,title:"\u81EA\u7531\u6709\u6548\u9918\u6C2Fmg/L",message:r.items.slice()},null,8,["message"])):h("",!0),s.message.length?(i(),u(m,{key:5,title:"\u5927\u8178\u687F\u83CC\u7FA4(CFU/100\u6BEB\u5347)",message:r.items.slice()},null,8,["message"])):h("",!0),s.message.length?(i(),u(m,{key:6,title:"\u7E3D\u83CC\u843D\u6578(CFU/\u6BEB\u5347)",message:r.items.slice()},null,8,["message"])):h("",!0),s.message.length?(i(),u(m,{key:7,title:"\u6C34\u6EAB(\u2103)",message:r.items.slice()},null,8,["message"])):h("",!0),f("footer",null,[o(v,{type:"text",href:"https://github.com/dwatow/TainanWaterGraph",target:"_blank"},{default:p(()=>[o(T),le]),_:1})])],64)}var ue=C(se,[["render",ce],["__scopeId","data-v-762ed5b1"]]);const he=f("h1",{style:{"text-align":"center"}},"\u53F0\u5357\u5E74\u5EA6\u7528\u6236\u7AEF\u6C34\u8CEA\u6AA2\u6E2C\u8CC7\u6599\u67E5\u8A62",-1),de={setup(e){return(t,a)=>(i(),_(x,null,[he,o(ue)],64))}};const b=I(de);b.use(q);b.config.errorHandler=e=>{console.error("handle error",e)};b.config.warnHandler=e=>{console.warn("handle warn",e)};b.mount("#app");
